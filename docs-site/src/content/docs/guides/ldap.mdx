---
title: LDAP Guide
description: OpenLDAP unified authentication across all services
---

import { Aside, Steps, Card, CardGrid } from '@astrojs/starlight/components';

Unified authentication with OpenLDAP across all services. One username and password for everything.

## Authentication Architecture

```mermaid
flowchart TB
    subgraph mgmt[Management Layer]
        phpLDAP[phpLDAPadmin<br/>Web UI]
    end

    subgraph ldap[LDAP Directory]
        LDAP[(OpenLDAP<br/>Users + Groups)]
    end

    subgraph sso[SSO Stack]
        Authelia[Authelia]
        PG[(PostgreSQL)]
        Redis[(Redis)]
    end

    subgraph direct[Direct Auth]
        Jellyfin[Jellyfin]
        Jellyseerr[Jellyseerr]
    end

    subgraph protected[SSO Protected]
        Grafana[Grafana]
        Arr[*arr Stack<br/>Radarr/Sonarr/Prowlarr]
        qBit[qBittorrent]
    end

    phpLDAP -->|Manage| LDAP
    LDAP -->|Validate| Authelia
    LDAP -->|Validate| Jellyfin
    Authelia --- PG
    Authelia --- Redis
    Jellyfin --> Jellyseerr
    Authelia -->|Protect| protected

    classDef mgmtStyle fill:#9c27b0,stroke:#7b1fa2,color:#fff
    classDef ldapStyle fill:#4caf50,stroke:#388e3c,color:#fff
    classDef ssoStyle fill:#2196f3,stroke:#1976d2,color:#fff
    classDef directStyle fill:#d1fae5,stroke:#059669,color:#065f46
    classDef protectedStyle fill:#dbeafe,stroke:#2563eb,color:#1e40af

    class phpLDAP mgmtStyle
    class LDAP ldapStyle
    class Authelia,PG,Redis ssoStyle
    class Jellyfin,Jellyseerr directStyle
    class Grafana,Arr,qBit protectedStyle
```

## Directory Structure

The LDAP directory is organized with separate organizational units for users and groups:

```mermaid
flowchart TB
    Root[dc=mykyta-ryasny,dc=dev]
    Users[ou=users]
    Groups[ou=groups]

    Admin[uid=admin]
    User1[uid=user1]
    UserN[uid=...]

    Admins[cn=admins]
    Family[cn=family]

    Root --> Users
    Root --> Groups
    Users --> Admin
    Users --> User1
    Users --> UserN
    Groups --> Admins
    Groups --> Family

    Admins -.->|member| Admin
    Family -.->|member| Admin
    Family -.->|member| User1

    classDef root fill:#4caf50,stroke:#388e3c,color:#fff
    classDef ou fill:#2196f3,stroke:#1976d2,color:#fff
    classDef user fill:#e3f2fd,stroke:#2196f3,color:#1565c0
    classDef group fill:#fff3e0,stroke:#ff9800,color:#e65100

    class Root root
    class Users,Groups ou
    class Admin,User1,UserN user
    class Admins,Family group
```

**Base DN**: `dc=mykyta-ryasny,dc=dev`

| Path | Purpose |
|------|---------|
| `ou=users` | User accounts |
| `ou=groups` | Group memberships |

## Managing Users

Access phpLDAPadmin at: `https://ldap.mykyta-ryasny.dev`

<Aside type="tip" title="Recommended Method">
Use phpLDAPadmin for most user management tasks. The web interface is easier than CLI commands.
</Aside>

### Add User via CLI

```bash
docker exec -it openldap ldapadd -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
objectClass: inetOrgPerson
objectClass: posixAccount
uid: newuser
cn: New User
sn: User
mail: newuser@example.com
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/newuser
userPassword: {SSHA}hashed_password
EOF
```

### Add User to Group

```bash
docker exec -it openldap ldapmodify -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: cn=family,ou=groups,dc=mykyta-ryasny,dc=dev
changetype: modify
add: member
member: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
EOF
```

## Authentication Flow

```mermaid
flowchart TB
    User([User])
    Service[Service]

    Authelia[Authelia]
    LDAP[(LDAP)]

    User -->|1. Request| Service
    Service -->|2. Verify| Authelia
    Authelia -->|3. Check| LDAP
    LDAP -->|4. Valid| Authelia
    Authelia -->|5. Grant| Service
    Service -->|6. Access| User

    classDef user fill:#dbeafe,stroke:#2563eb,color:#1e40af
    classDef svc fill:#d1fae5,stroke:#059669,color:#065f46
    classDef auth fill:#fce7f3,stroke:#db2777,color:#9d174d
    classDef ldap fill:#e0e7ff,stroke:#4f46e5,color:#3730a3

    class User user
    class Service svc
    class Authelia auth
    class LDAP ldap
```

## Authelia Integration

Authelia connects to LDAP for user authentication and group membership:

```yaml
authentication_backend:
  ldap:
    address: ldap://openldap:389
    base_dn: dc=mykyta-ryasny,dc=dev
    users_filter: (&(|({username_attribute}={input}))(objectClass=inetOrgPerson))
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    user: cn=admin,dc=mykyta-ryasny,dc=dev
```

## Jellyfin Integration

Jellyfin uses direct LDAP authentication via its plugin:

<Steps>
1. Install the **LDAP-Auth** plugin from Jellyfin's plugin catalog

2. Configure LDAP connection:
   - **Server**: `ldap://openldap:389`
   - **Base DN**: `dc=mykyta-ryasny,dc=dev`
   - **Username Attribute**: `uid`

3. Configure admin filter:
   ```
   (memberOf=cn=admins,ou=groups,dc=mykyta-ryasny,dc=dev)
   ```

4. Restart Jellyfin to apply changes
</Steps>

<Aside type="caution" title="Jellyseerr Auth">
Jellyseerr authenticates through Jellyfin, not directly to LDAP. Users must exist in Jellyfin first (auto-created on login).
</Aside>

## Access Control

Group membership determines which services users can access:

```mermaid
flowchart LR
    subgraph groups[LDAP Groups]
        Admins[cn=admins]
        Family[cn=family]
    end

    subgraph admin[Admin Only Services]
        Grafana[Grafana]
        Arr[*arr Stack]
        qBit[qBittorrent]
        phpLDAP[phpLDAPadmin]
    end

    subgraph media[Media Services]
        Jellyfin[Jellyfin]
        Jellyseerr[Jellyseerr]
    end

    Admins -->|Full Access| admin
    Admins -->|Full Access| media
    Family -->|View Only| media

    classDef groupStyle fill:#9c27b0,stroke:#7b1fa2,color:#fff
    classDef adminStyle fill:#ffcdd2,stroke:#f44336,color:#b71c1c
    classDef mediaStyle fill:#c8e6c9,stroke:#4caf50,color:#1b5e20

    class Admins,Family groupStyle
    class Grafana,Arr,qBit,phpLDAP adminStyle
    class Jellyfin,Jellyseerr mediaStyle
```

| Group | Access Level |
|-------|--------------|
| `admins` | All services (Grafana, Radarr, Sonarr, Prowlarr, qBittorrent, phpLDAPadmin) |
| `family` | Media services only (Jellyfin, Jellyseerr) |

## Quick Commands

<CardGrid>
  <Card title="List Users" icon="document">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=users,dc=mykyta-ryasny,dc=dev" uid
    ```
  </Card>
  <Card title="List Groups" icon="list-format">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" cn
    ```
  </Card>
</CardGrid>

## Troubleshooting

### User can't login

<Steps>
1. Verify user exists in LDAP:
   ```bash
   docker exec openldap ldapsearch -x -b "dc=mykyta-ryasny,dc=dev" "uid=username"
   ```

2. Check password works:
   ```bash
   docker exec openldap ldapwhoami -x -D "uid=username,ou=users,dc=mykyta-ryasny,dc=dev" -W
   ```

3. Verify group membership:
   ```bash
   docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" "(member=uid=username,ou=users,dc=mykyta-ryasny,dc=dev)"
   ```
</Steps>

### Authelia can't connect to LDAP

Check LDAP container is healthy:
```bash
docker logs openldap --tail 20
```

Verify network connectivity:
```bash
docker exec authelia nc -zv openldap 389
```
