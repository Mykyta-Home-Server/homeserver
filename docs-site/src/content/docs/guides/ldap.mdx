---
title: LDAP Guide
description: OpenLDAP unified authentication across all services
---

import { Aside, Steps, Card, CardGrid } from '@astrojs/starlight/components';

Unified authentication with OpenLDAP across all services. One username and password for everything.

## Authentication Architecture

```mermaid
block-beta
    columns 3

    block:mgmt:1
        columns 1
        mg1["phpLDAPadmin"]
    end

    block:ldap:1
        columns 1
        l1[("ou=users")]
        l2[("ou=groups")]
    end

    block:sso:1
        columns 1
        s1["Authelia"]
        s2[("PostgreSQL")]
        s3[("Redis")]
    end

    space:3

    block:direct:1
        columns 1
        d1["Jellyfin"]
        d2["Jellyseerr"]
    end

    space:1

    block:protected:1
        columns 1
        p1["Grafana"]
        p2["Radarr"]
        p3["Sonarr"]
        p4["Prowlarr"]
        p5["qBittorrent"]
    end

    mg1 --> l1
    mg1 --> l2
    l1 --> s1
    l2 --> s1
    s1 --> s2
    s1 --> s3
    l1 --> d1
    l2 --> d1
    d1 --> d2
    s1 --> p1
    s1 --> p2
    s1 --> p3
    s1 --> p4
    s1 --> p5

    style mgmt fill:#9c27b0,stroke:#7b1fa2
    style ldap fill:#4caf50,stroke:#388e3c
    style sso fill:#2196f3,stroke:#1976d2
    style direct fill:#d1fae5,stroke:#059669
    style protected fill:#dbeafe,stroke:#2563eb
```

## Directory Structure

The LDAP directory is organized with separate organizational units for users and groups:

```mermaid
block-beta
    columns 3

    root["dc=mykyta-ryasny,dc=dev"]:3

    space users["ou=users"] groups["ou=groups"]

    space:1
    block:userlist:1
        columns 1
        u1["uid=admin"]
        u2["uid=user1"]
        u3["uid=..."]
    end
    block:grouplist:1
        columns 1
        g1["cn=admins"]
        g2["cn=family"]
    end

    root --> users
    root --> groups
    users --> userlist
    groups --> grouplist
    g1 -.-> u1
    g2 -.-> u1
    g2 -.-> u2

    style root fill:#4caf50,stroke:#388e3c
    style users fill:#2196f3,stroke:#1976d2
    style groups fill:#ff9800,stroke:#f57c00
    style userlist fill:#e3f2fd,stroke:#2196f3
    style grouplist fill:#fff3e0,stroke:#ff9800
```

**Base DN**: `dc=mykyta-ryasny,dc=dev`

| Path | Purpose |
|------|---------|
| `ou=users` | User accounts |
| `ou=groups` | Group memberships |

## Managing Users

Access phpLDAPadmin at: `https://ldap.mykyta-ryasny.dev`

<Aside type="tip" title="Recommended Method">
Use phpLDAPadmin for most user management tasks. The web interface is easier than CLI commands.
</Aside>

### Add User via CLI

```bash
docker exec -it openldap ldapadd -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
objectClass: inetOrgPerson
objectClass: posixAccount
uid: newuser
cn: New User
sn: User
mail: newuser@example.com
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/newuser
userPassword: {SSHA}hashed_password
EOF
```

### Add User to Group

```bash
docker exec -it openldap ldapmodify -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: cn=family,ou=groups,dc=mykyta-ryasny,dc=dev
changetype: modify
add: member
member: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
EOF
```

## Authentication Flow

```mermaid
block-beta
    columns 4

    u["User"]:1
    svc["Service"]:1
    auth["Authelia"]:1
    ldap[("LDAP")]:1

    space:4

    block:flow:4
        columns 1
        f1["1. User accesses service"]
        f2["2. Service checks with Authelia"]
        f3["3. Authelia validates against LDAP"]
        f4["4. LDAP returns user + groups"]
        f5["5. Authelia sets session cookie"]
        f6["6. Service grants access with headers"]
    end

    u --> svc
    svc --> auth
    auth --> ldap
    ldap --> auth
    auth --> svc
    svc --> u

    style u fill:#dbeafe,stroke:#2563eb
    style svc fill:#d1fae5,stroke:#059669
    style auth fill:#fce7f3,stroke:#db2777
    style ldap fill:#e0e7ff,stroke:#4f46e5
    style flow fill:#f3f4f6,stroke:#6b7280
```

## Authelia Integration

Authelia connects to LDAP for user authentication and group membership:

```yaml
authentication_backend:
  ldap:
    address: ldap://openldap:389
    base_dn: dc=mykyta-ryasny,dc=dev
    users_filter: (&(|({username_attribute}={input}))(objectClass=inetOrgPerson))
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    user: cn=admin,dc=mykyta-ryasny,dc=dev
```

## Jellyfin Integration

Jellyfin uses direct LDAP authentication via its plugin:

<Steps>
1. Install the **LDAP-Auth** plugin from Jellyfin's plugin catalog

2. Configure LDAP connection:
   - **Server**: `ldap://openldap:389`
   - **Base DN**: `dc=mykyta-ryasny,dc=dev`
   - **Username Attribute**: `uid`

3. Configure admin filter:
   ```
   (memberOf=cn=admins,ou=groups,dc=mykyta-ryasny,dc=dev)
   ```

4. Restart Jellyfin to apply changes
</Steps>

<Aside type="caution" title="Jellyseerr Auth">
Jellyseerr authenticates through Jellyfin, not directly to LDAP. Users must exist in Jellyfin first (auto-created on login).
</Aside>

## Access Control

Group membership determines which services users can access:

```mermaid
block-beta
    columns 3

    block:groups:1
        columns 1
        g1["cn=admins"]
        g2["cn=family"]
    end

    block:admin:1
        columns 1
        a1["Grafana"]
        a2["Radarr"]
        a3["Sonarr"]
        a4["Prowlarr"]
        a5["qBittorrent"]
        a6["phpLDAPadmin"]
    end

    block:family:1
        columns 1
        f1["Jellyfin"]
        f2["Jellyseerr"]
    end

    g1 --> admin
    g1 --> family
    g2 --> family

    style groups fill:#9c27b0,stroke:#7b1fa2
    style admin fill:#ffcdd2,stroke:#f44336
    style family fill:#c8e6c9,stroke:#4caf50
```

| Group | Access Level |
|-------|--------------|
| `admins` | All services (Grafana, Radarr, Sonarr, Prowlarr, qBittorrent, phpLDAPadmin) |
| `family` | Media services only (Jellyfin, Jellyseerr) |

## Quick Commands

<CardGrid>
  <Card title="List Users" icon="document">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=users,dc=mykyta-ryasny,dc=dev" uid
    ```
  </Card>
  <Card title="List Groups" icon="list-format">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" cn
    ```
  </Card>
</CardGrid>

## Troubleshooting

### User can't login

<Steps>
1. Verify user exists in LDAP:
   ```bash
   docker exec openldap ldapsearch -x -b "dc=mykyta-ryasny,dc=dev" "uid=username"
   ```

2. Check password works:
   ```bash
   docker exec openldap ldapwhoami -x -D "uid=username,ou=users,dc=mykyta-ryasny,dc=dev" -W
   ```

3. Verify group membership:
   ```bash
   docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" "(member=uid=username,ou=users,dc=mykyta-ryasny,dc=dev)"
   ```
</Steps>

### Authelia can't connect to LDAP

Check LDAP container is healthy:
```bash
docker logs openldap --tail 20
```

Verify network connectivity:
```bash
docker exec authelia nc -zv openldap 389
```
