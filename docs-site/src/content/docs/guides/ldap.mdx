---
title: LDAP Guide
description: OpenLDAP unified authentication across all services
---

import { Aside, Steps, Card, CardGrid } from '@astrojs/starlight/components';

Unified authentication with OpenLDAP across all services. One username and password for everything.

## Authentication Architecture

```mermaid
flowchart TB
    subgraph mgmt["`**Management**`"]
        phpLDAP@{ shape: rect, label: "phpLDAPadmin" }
    end

    subgraph ldap["`**Directory**`"]
        LDAP@{ shape: cyl, label: "OpenLDAP" }
    end

    subgraph sso["`**SSO Stack**`"]
        direction LR
        Authelia@{ shape: rect, label: "Authelia" }
        PG@{ shape: cyl, label: "PostgreSQL" }
        Redis@{ shape: cyl, label: "Redis" }
    end

    subgraph direct["`**Direct Auth**`"]
        direction LR
        Jellyfin@{ shape: cyl, label: "Jellyfin" }
        Jellyseerr@{ shape: rect, label: "Jellyseerr" }
    end

    subgraph protected["`**SSO Protected**`"]
        direction LR
        Grafana@{ shape: rect, label: "Grafana" }
        Arr@{ shape: rect, label: "*arr" }
        qBit@{ shape: rect, label: "qBit" }
    end

    phpLDAP --> LDAP
    LDAP --> Authelia & Jellyfin
    Authelia --- PG & Redis
    Jellyfin --> Jellyseerr
    Authelia --> protected

    classDef mgmtStyle fill:#e9d5ff,stroke:#a855f7,stroke-width:2px
    classDef ldapStyle fill:#a7f3d0,stroke:#10b981,stroke-width:2px
    classDef ssoStyle fill:#bae6fd,stroke:#0ea5e9,stroke-width:2px
    classDef directStyle fill:#d1fae5,stroke:#059669,stroke-width:2px
    classDef protectedStyle fill:#dbeafe,stroke:#3b82f6,stroke-width:2px

    class phpLDAP mgmtStyle
    class LDAP ldapStyle
    class Authelia,PG,Redis ssoStyle
    class Jellyfin,Jellyseerr directStyle
    class Grafana,Arr,qBit protectedStyle
```

## Directory Structure

The LDAP directory is organized with separate organizational units for users and groups:

```mermaid
flowchart TB
    Root@{ shape: cyl, label: "dc=mykyta-ryasny,dc=dev" }

    Users@{ shape: rect, label: "ou=users" }
    Groups@{ shape: rect, label: "ou=groups" }

    Admin@{ shape: circle, label: "admin" }
    User1@{ shape: circle, label: "user1" }
    UserN@{ shape: circle, label: "..." }

    Admins@{ shape: hex, label: "admins" }
    Family@{ shape: hex, label: "family" }

    Root --> Users & Groups
    Users --> Admin & User1 & UserN
    Groups --> Admins & Family

    Admins -.-> Admin
    Family -.-> Admin & User1

    classDef root fill:#a7f3d0,stroke:#10b981,stroke-width:2px
    classDef ou fill:#bae6fd,stroke:#0ea5e9,stroke-width:2px
    classDef user fill:#dbeafe,stroke:#3b82f6,stroke-width:2px
    classDef group fill:#fed7aa,stroke:#f97316,stroke-width:2px

    class Root root
    class Users,Groups ou
    class Admin,User1,UserN user
    class Admins,Family group
```

**Base DN**: `dc=mykyta-ryasny,dc=dev`

| Path | Purpose |
|------|---------|
| `ou=users` | User accounts |
| `ou=groups` | Group memberships |

## Managing Users

Access phpLDAPadmin at: `https://ldap.mykyta-ryasny.dev`

<Aside type="tip" title="Recommended Method">
Use phpLDAPadmin for most user management tasks. The web interface is easier than CLI commands.
</Aside>

### Add User via CLI

```bash
docker exec -it openldap ldapadd -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
objectClass: inetOrgPerson
objectClass: posixAccount
uid: newuser
cn: New User
sn: User
mail: newuser@example.com
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/newuser
userPassword: {SSHA}hashed_password
EOF
```

### Add User to Group

```bash
docker exec -it openldap ldapmodify -x -D "cn=admin,dc=mykyta-ryasny,dc=dev" -W << 'EOF'
dn: cn=family,ou=groups,dc=mykyta-ryasny,dc=dev
changetype: modify
add: member
member: uid=newuser,ou=users,dc=mykyta-ryasny,dc=dev
EOF
```

## Authentication Flow

```mermaid
sequenceDiagram
    actor User
    participant Service
    participant Authelia
    participant LDAP as OpenLDAP

    User->>Service: 1. Access Service
    Service->>Authelia: 2. Forward Auth Request
    Authelia->>LDAP: 3. Query User & Groups
    LDAP-->>Authelia: 4. Return Credentials
    Authelia-->>Service: 5. Grant/Deny Access
    Service-->>User: 6. Return Response
```

## Authelia Integration

Authelia connects to LDAP for user authentication and group membership:

```yaml
authentication_backend:
  ldap:
    address: ldap://openldap:389
    base_dn: dc=mykyta-ryasny,dc=dev
    users_filter: (&(|({username_attribute}={input}))(objectClass=inetOrgPerson))
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    user: cn=admin,dc=mykyta-ryasny,dc=dev
```

## Jellyfin Integration

Jellyfin uses direct LDAP authentication via its plugin:

<Steps>
1. Install the **LDAP-Auth** plugin from Jellyfin's plugin catalog

2. Configure LDAP connection:
   - **Server**: `ldap://openldap:389`
   - **Base DN**: `dc=mykyta-ryasny,dc=dev`
   - **Username Attribute**: `uid`

3. Configure admin filter:
   ```
   (memberOf=cn=admins,ou=groups,dc=mykyta-ryasny,dc=dev)
   ```

4. Restart Jellyfin to apply changes
</Steps>

<Aside type="caution" title="Jellyseerr Auth">
Jellyseerr authenticates through Jellyfin, not directly to LDAP. Users must exist in Jellyfin first (auto-created on login).
</Aside>

## Access Control

Group membership determines which services users can access:

```mermaid
flowchart TB
    subgraph groups["`**Groups**`"]
        direction LR
        Admins@{ shape: hex, label: "admins" }
        Family@{ shape: hex, label: "family" }
    end

    subgraph admin["`**Admin Only**`"]
        direction TB
        row1_admin[" "]
        row2_admin[" "]

        Grafana@{ shape: rect, label: "Grafana" }
        Arr@{ shape: rect, label: "*arr" }
        qBit@{ shape: rect, label: "qBit" }
        phpLDAP@{ shape: rect, label: "phpLDAP" }

        row1_admin ~~~ row2_admin
        Grafana ~~~ Arr
        qBit ~~~ phpLDAP
    end

    subgraph media["`**Media Services**`"]
        direction LR
        Jellyfin@{ shape: cyl, label: "Jellyfin" }
        Jellyseerr@{ shape: rect, label: "Jellyseerr" }
    end

    Admins --> admin
    Admins & Family --> media

    style row1_admin fill:none,stroke:none
    style row2_admin fill:none,stroke:none

    classDef groupStyle fill:#e9d5ff,stroke:#a855f7,stroke-width:2px
    classDef adminStyle fill:#fecaca,stroke:#ef4444,stroke-width:2px
    classDef mediaStyle fill:#a7f3d0,stroke:#10b981,stroke-width:2px

    class Admins,Family groupStyle
    class Grafana,Arr,qBit,phpLDAP adminStyle
    class Jellyfin,Jellyseerr mediaStyle
```

| Group | Access Level |
|-------|--------------|
| `admins` | All services (Grafana, Radarr, Sonarr, Prowlarr, qBittorrent, phpLDAPadmin) |
| `family` | Media services only (Jellyfin, Jellyseerr) |

## Quick Commands

<CardGrid>
  <Card title="List Users" icon="document">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=users,dc=mykyta-ryasny,dc=dev" uid
    ```
  </Card>
  <Card title="List Groups" icon="list-format">
    ```bash
    docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" cn
    ```
  </Card>
</CardGrid>

## Troubleshooting

### User can't login

<Steps>
1. Verify user exists in LDAP:
   ```bash
   docker exec openldap ldapsearch -x -b "dc=mykyta-ryasny,dc=dev" "uid=username"
   ```

2. Check password works:
   ```bash
   docker exec openldap ldapwhoami -x -D "uid=username,ou=users,dc=mykyta-ryasny,dc=dev" -W
   ```

3. Verify group membership:
   ```bash
   docker exec openldap ldapsearch -x -b "ou=groups,dc=mykyta-ryasny,dc=dev" "(member=uid=username,ou=users,dc=mykyta-ryasny,dc=dev)"
   ```
</Steps>

### Authelia can't connect to LDAP

Check LDAP container is healthy:
```bash
docker logs openldap --tail 20
```

Verify network connectivity:
```bash
docker exec authelia nc -zv openldap 389
```
