# ============================================================================
# Home Server - Docker Compose Configuration
# ============================================================================
# Services organized by category in compose/ subdirectories
#
# Environment variables loaded from .env file
#
# ============================================================================
# Docker Compose Profiles
# ============================================================================
# This project uses profiles to control which services start:
#
# DEFAULT (no profile):
#   docker compose up -d
#   → Starts: Infrastructure + Authentication
#   → Services: caddy, cloudflared, postgres-auth, redis-auth, authentik-server, authentik-worker
#
# PROFILES:
#   --profile web         : Web applications (portal, hello-world)
#   --profile media       : Media stack (Jellyfin, Sonarr, Radarr, etc.)
#   --profile monitoring  : Monitoring (Grafana, Loki, Promtail)
#   --profile maintenance : Dockerized cron jobs (backup, cleanup)
#   --profile cicd        : GitHub Actions runner
#   --profile all         : Everything
#
# EXAMPLES:
#   # Start infrastructure + auth + media + monitoring
#   docker compose --profile media --profile monitoring up -d
#
#   # Start everything
#   docker compose --profile all up -d
#
#   # Start just core services (infra + auth)
#   docker compose up -d
# ============================================================================

include:
  # =========================================================================
  # Network Definitions (must be first)
  # =========================================================================
  - compose/_networks.yml

  # =========================================================================
  # Infrastructure - Core services that always run
  # =========================================================================
  - compose/infrastructure/proxy.yml           # Caddy reverse proxy
  - compose/infrastructure/tunnel.yml          # Cloudflare Tunnel

  # =========================================================================
  # CI/CD - GitHub Actions runner (profile: cicd, all)
  # =========================================================================
  - compose/ci/github-runner.yml               # Self-hosted runner

  # =========================================================================
  # Authentication Stack - Always runs
  # =========================================================================
  - compose/auth/postgres.yml                  # PostgreSQL for auth services
  - compose/auth/redis.yml                     # Redis for sessions
  - compose/auth/authentik.yml                 # Authentik SSO identity provider

  # =========================================================================
  # Media Stack (profile: media, all)
  # =========================================================================
  - compose/media/qbittorrent.yml              # Download client
  - compose/media/jellyfin.yml                 # Media server
  - compose/media/radarr.yml                   # Movie management
  - compose/media/sonarr.yml                   # TV show management
  - compose/media/prowlarr.yml                 # Indexer management
  - compose/media/jellyseerr.yml               # Request management
  - compose/media/flaresolverr.yml             # Cloudflare bypass for indexers
  - compose/media/bazarr.yml                   # Automatic subtitles
  - compose/media/recyclarr.yml                # TRaSH Guides quality sync

  # =========================================================================
  # Monitoring Stack (profile: monitoring, all)
  # =========================================================================
  - compose/monitoring/stack.yml               # Loki, Promtail, Grafana

  # =========================================================================
  # Maintenance (profile: maintenance, all)
  # =========================================================================
  - compose/maintenance/cron.yml               # Dockerized cron jobs

  # =========================================================================
  # Web Applications (profile: web, all)
  # =========================================================================
  - compose/web/portal.yml                     # Angular home dashboard
  - compose/web/hello-world.yml                # Test application
