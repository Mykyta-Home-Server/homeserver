# ============================================================================
# Web Applications - Docker Compose Configuration
# ============================================================================
# Services: Portal (Angular dashboard), Hello World (test app)
# Networks: internal (accessed via Caddy reverse proxy)
# Profile: web (optional - uncomment profiles to make optional)
# ============================================================================

services:
  # ==========================================================================
  # Hello World - Simple test application
  # ==========================================================================
  hello-world:
    profiles: ["web", "all"]
    image: nginx:alpine
    container_name: hello-world
    restart: unless-stopped

    # Volumes
    volumes:
      - ../services/web/hello-world/index.html:/usr/share/nginx/html/index.html:ro

    # Networks - internal only (accessed via Caddy)
    networks:
      - internal

    # Health check
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

    # Security
    security_opt:
      - no-new-privileges:true

    # Labels
    labels:
      - "com.homeserver.group=web"
      - "com.homeserver.description=Simple test application"

  # ==========================================================================
  # Angular Portal - Home dashboard
  # ==========================================================================
  portal:
    profiles: ["web", "all"]
    image: ghcr.io/mykyta-home-server/homeserver-portal:latest
    container_name: portal
    restart: unless-stopped

    # Networks - internal only (accessed via Caddy)
    networks:
      - internal

    # Health check - check nginx is serving the Angular app
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Security
    security_opt:
      - no-new-privileges:true

    # Labels
    labels:
      - "com.homeserver.group=web"
      - "com.homeserver.description=Angular home dashboard"
